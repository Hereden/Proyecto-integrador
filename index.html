<!doctype html>
<html lang="es">

<head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css"
        integrity="sha384-B0vP5xmATw1+K9KRQjQERJvTumQW0nPEzvF6L/Z6nronJ3oUOFUFpCjEUQouq2+l" crossorigin="anonymous">
    <link rel="stylesheet" href="assets/css/style.css">
    <link rel="icon" href="/assets/images/TR L.ico">
    <title>TlacuaRiders</title>
</head>

<body>
    <div id="nav-placeholder">

    </div>
    <div class="">
        <div class="row">
            <!-- Columna de la izquierda -->
            <div class="col-3" id="columnaIzquierda">
            </div>
            <!-- Columna derecha -->
            <div class="col-9" id="columnaDerecha">
            </div>
        </div>
    </div>

    <div id="precarga">

    </div>
    <div id="footer">

    </div>


    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
        integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-Piv4xVNRyMGpqkS2by6br4gNJ7DXjqk09RmUpJ8jgGtD7zP9yug3goQfGII0yAns"
        crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
    <script src="assets/js/script.js"></script>
    <script>
        /* Obtenemos nuestro navbar del html y lo ponemos 
         * en el div con ese id*/
        jQuery.get("./navbar.html", function (data) {
            $("#nav-placeholder").replaceWith(data);
        });

        /* Obtenemos nuestro footer del html y lo ponemos 
         * en el div con ese id*/
        jQuery.get("./footer.html", function (data) {
            $("#footer").replaceWith(data);
        });

        /* Obtenemos nuestro slider y tres imagenes 
         * del html y lo ponemos en el div con ese id*/
        jQuery.get("./precarga.html", function (data) {
            $("#precarga").replaceWith(data);
        });

        /*Declaramos variables para guardar todos los articulos
         * y la categoria donde estamos actualmente*/
        let TODOS_LOS_ARTICULOS;
        let categoriaNumero = 0;

        /* Funcion para repintar el div de index y borrar los otros dos divs*/
        function volverAlIndex() {
            let columnaIzquierda = document.querySelector("#columnaIzquierda").textContent = "";
            let columnaDerecha = document.querySelector("#columnaDerecha").textContent = "";
            jQuery.get("./precarga.html", function (data) {
                $("#precarga").replaceWith(data);
            });
        }

        /* Funcion para repintar el div con el contenido de
         * nosotros y borrar el contenido de los otros dos divs*/
        function IrANosotros() {
            let columnaIzquierda = document.querySelector("#columnaIzquierda").textContent = "";
            let columnaDerecha = document.querySelector("#columnaDerecha").textContent = "";
            jQuery.get("./nosotros2.html", function (data) {
                $("#precarga").replaceWith(data);
            });
        }

        /* Buscamos cargar los articulos */
        cargarArticulos();

        /* Función para hacer la petición por medio de fetch
         * en la url donde esta el backend y la ruta de articulos
         * al finalizar guardamos la respuesta en la variable previamente declarada*/
        function cargarArticulos() {
            fetch(URLBACKEND + 'articulos', {
                method: 'GET',
                headers: {
                    "Content-Type": "application/json"
                }
            })
                .then(resp => resp.json()).then(data => {
                    TODOS_LOS_ARTICULOS = data;
                });
        }

        /* Si nos piden repintar las cards, vamos a 
         * generar la columna izquierda y derecha
         * para que al finalizar se muestren */
        function cambiarCards(num) {
            let precarga = document.querySelector("#precarga").textContent = "";
            categoriaNumero = num;
            generarCardsDinamicamente(num);
            generarColumnaIzquierda();

        }

        /* Generamos la columna de filtros*/
        function generarColumnaIzquierda() {
            /*Obtenemos div de columna izquierda*/
            let columnaIzquierda = document.querySelector("#columnaIzquierda");
            /*Vaciamos el div para evitar generar varios divs*/
            columnaIzquierda.textContent = "";
            /* Creamos el titulo como un h5
             * Agregamos su clase y 
             * Agregamos el texto
             * */
            let buscarNombre = document.createElement("h5");
            buscarNombre.className += "ml-4 texto_50";
            buscarNombre.appendChild(document.createTextNode("Buscar por nombre"));
            /* Creamos el input donde buscaremos por nombre de artículo
             * Ponemos un placeholder
             * Ponemos un id para saber el contenido
             * Generamos la función donde escucha cada vez que soltamos una tecla*/
            let inputBuscarNombre = document.createElement("input");
            inputBuscarNombre.placeholder = "Buscar artículo";
            inputBuscarNombre.id = "buscarNombre"
            inputBuscarNombre.type = "search";
            inputBuscarNombre.className += "mr-sm-2 texto_50 bg_black texto_amarillo";
            inputBuscarNombre.addEventListener("keyup", () => {
                buscar("buscarNombre", "nombre")
            });

            /* Creamos el titulo como un h5
             * Agregamos su clase y 
             * Agregamos el texto
             * */
            let buscarPrecio = document.createElement("h5");
            buscarPrecio.className += "ml-4 texto_50";
            buscarPrecio.appendChild(document.createTextNode("Buscar por precio"));
            let inputBuscarPrecio = document.createElement("input");
            /* Creamos el input donde buscaremos por precio del artículo
             * Ponemos un placeholder
             * Ponemos un id para saber el contenido
             * Generamos la función donde escucha cada vez que soltamos una tecla*/
            inputBuscarPrecio.placeholder = "Buscar por precio";
            inputBuscarPrecio.id = "buscarPrecio"
            inputBuscarPrecio.type = "search";
            inputBuscarPrecio.className += "mr-sm-2 texto_50 bg_black texto_amarillo";
            inputBuscarPrecio.addEventListener("keyup", () => {
                buscar("buscarPrecio", "precio")
            });

            /* Agregamos los títulos "Buscar por nombre" y "Buscar por precio"
             * Agregamos los inputs despues de los títulos 
             * Para que se vean en nuestra columna izquierda*/
            columnaIzquierda.appendChild(buscarNombre);
            columnaIzquierda.appendChild(inputBuscarNombre);
            columnaIzquierda.appendChild(buscarPrecio);
            columnaIzquierda.appendChild(inputBuscarPrecio);
        }

        function generarCardsDinamicamente(numeroCategoria) {
            /*Obtenemos div de columna derecha*/
            var columnaDerecha = document.querySelector("#columnaDerecha");
            columnaDerecha.textContent = "";
            /*Generamos la fila donde iran todos los articulos de la página*/
            let row1 = document.createElement("div");
            row1.className += "row";
            /*Generamos otra fila donde separamos en 3 articulos por fila*/
            let row2 = document.createElement("div");
            row2.className += "row row-cols-3 row-cols-md-3 m-2";
            /*Agarramos nuestro Array con lista de json*/
            /*Por cada elemento vamos a*/
            TODOS_LOS_ARTICULOS.forEach((element) => {
                if (element.categoria == numeroCategoria) {
                    /*Generar el marco de la card*/
                    let marcoCard = document.createElement("div");
                    marcoCard.className += "col mb-4";
                    /*Generamos la card con fondo negro*/
                    let card = document.createElement("div");
                    card.className += "card bg-dark";
                    /*Generamos la forma de la card*/
                    let cardLayout = document.createElement("div");
                    cardLayout.className += "card-body";
                    /*Generamos en donde va a ponerse la imagen*/
                    let imagenCard = document.createElement("img");
                    imagenCard.className += "card-img-top";
                    /*Generamos donde se va a poner el titulo del articulo*/
                    let tituloCard = document.createElement("h5");
                    tituloCard.className += "card-title texto_white font_footer_text text-overflow-cards-1";
                    /*Generamos donde se va poner la descripcion del articulo*/
                    let descCard = document.createElement("p");
                    descCard.className +=
                        "card-text text-overflow-cards texto_white texto_50 font_footer";
                    /*Generamos donde se va a poner el precio*/
                    let precioCard = document.createElement("p");
                    precioCard.className +=
                        "texto_white font_footer_text align-self-center";
                    precioCard.setAttribute("style",
                        "font-size:23px;text-align: center;");
                    /*Generamos el boton de compra*/
                    let botonCard = document.createElement("button");
                    botonCard.className += "font_footer_text"
                    botonCard.setAttribute(
                        "style",
                        "border-color: #FFD103;background-color: black;color: #FFD103;border: 1px;width=100%;font-size:20px"
                    );
                    /*Generamos el div donde se pondrian las tallas*/
                    let tallas1 = document.createElement("div");
                    tallas1.className += "";

                    /*Obtenemos el url del json para la imagen*/
                    imagenCard.src = element.url;
                    /*Obtenemos el titulo para el texto alternativo*/
                    imagenCard.alt = element.nombre;
                    /*Obtenemos el titulo del json*/
                    tituloCard.appendChild(document.createTextNode(element.nombre));
                    /*Obtenemos la descripcion del json*/
                    descCard.appendChild(document.createTextNode(element.descripcion));
                    /*Obtenemos el precio del json*/
                    precioCard.appendChild(document.createTextNode(`$ ${Intl.NumberFormat().format(element.precio)}`));
                    /*Terminamos de generar el texto del boton para comprar*/
                    botonCard.appendChild(document.createTextNode(`Comprar`));
                    /*Aqui agregaremos funcionalidad del boton comprar*/
                    botonCard.addEventListener("click", function () {
                        console.log(element);
                        let carrito = localStorage.getItem("carrito");
                        if (carrito) {
                            let carrito2 = [];
                            carrito2 = JSON.parse(carrito);
                            let agregarCarrito = true;
                            carrito2.forEach(function (task) {
                                if (task.nombre == element.nombre) {
                                    agregarCarrito = false;
                                }
                            });
                            if (agregarCarrito) {
                                carrito2.push(element);
                            }
                            localStorage.setItem("carrito", JSON.stringify(carrito2));
                        } else {
                            let carrito = [];
                            carrito.push(element);
                            localStorage.setItem("carrito", JSON.stringify(carrito));
                        }

                    });

                    /*Agregamos las tallas, el boton de compra, titulo y descripcion 
                    * al layout que es la parte que veremos cuando nos posicionemos 
                    * encima de la card*/
                    cardLayout.appendChild(tituloCard);

                    /*Agregamos a la card la imagen, el precio y la parte de encima de la card*/
                    card.appendChild(imagenCard);
                    card.appendChild(cardLayout);
                    card.appendChild(precioCard);
                    card.appendChild(tallas1);
                    card.appendChild(botonCard);

                    /*Agregar la card al marco*/
                    marcoCard.appendChild(card);
                    /*Agregar el marco a nuestra filas de cards*/
                    row2.appendChild(marcoCard);
                }
            });
            /*Agregamos nuestra segunda fila a la primera*/
            row1.appendChild(row2);
            /*Agregamos la primer fila a nuestra columna derecha*/
            columnaDerecha.appendChild(row1);
        }


        function buscar(idForm, parametro) {
            var searchField = $(`#${idForm}`).val();
            if (searchField === '') {
                $('#columnaDerecha').html('');
                return;
            }

            var regex = new RegExp(searchField, "i");
            var output = "";
            var count = 1;
            /*Obtenemos div de columna derecha*/
            var columnaDerecha = document.querySelector("#columnaDerecha");
            columnaDerecha.textContent = "";
            /*Generamos la fila donde iran todos los articulos de la página*/
            let row1 = document.createElement("div");
            row1.className += "row";
            /*Generamos otra fila donde separamos en 3 articulos por fila*/
            let row2 = document.createElement("div");
            row2.className += "row row-cols-3 row-cols-md-3 m-2";
            /*Agarramos nuestro Array con lista de json*/
            /*Por cada elemento vamos a*/
            $.each(TODOS_LOS_ARTICULOS, function (key, val) {
                if (val.categoria == categoriaNumero) {
                    if ((val[parametro].toString().search(regex) != -1) || (val[parametro].toString().search(regex) != -1)) {

                        /*Generar el marco de la card*/
                        let marcoCard = document.createElement("div");
                        marcoCard.className += "col mb-4";
                        /*Generamos la card con fondo negro*/
                        let card = document.createElement("div");
                        card.className += "card bg-dark";
                        /*Generamos la forma de la card*/
                        let cardLayout = document.createElement("div");
                        cardLayout.className += "card-body";
                        /*Generamos en donde va a ponerse la imagen*/
                        let imagenCard = document.createElement("img");
                        imagenCard.className += "card-img-top";
                        /*Generamos donde se va a poner el titulo del articulo*/
                        let tituloCard = document.createElement("h5");
                        tituloCard.className += "card-title texto_white font_footer_text text-overflow-cards-1";
                        /*Generamos donde se va poner la descripcion del articulo*/
                        let descCard = document.createElement("p");
                        descCard.className +=
                            "card-text text-overflow-cards texto_white texto_50 font_footer";
                        /*Generamos donde se va a poner el precio*/
                        let precioCard = document.createElement("p");
                        precioCard.className +=
                            "texto_white font_footer_text align-self-center";
                        precioCard.setAttribute("style",
                            "font-size:23px;text-align: center;");
                        /*Generamos el boton de compra*/
                        let botonCard = document.createElement("button");
                        botonCard.className += "font_footer_text"
                        botonCard.setAttribute(
                            "style",
                            "border-color: #FFD103;background-color: black;color: #FFD103;border: 1px;width=100%;font-size:20px"
                        );
                        /*Generamos el div donde se pondrian las tallas*/
                        let tallas1 = document.createElement("div");
                        tallas1.className += "";

                        /*Obtenemos el url del json para la imagen*/
                        imagenCard.src = val.url;
                        /*Obtenemos el titulo para el texto alternativo*/
                        imagenCard.alt = val.nombre;
                        /*Obtenemos el titulo del json*/
                        tituloCard.appendChild(document.createTextNode(val.nombre));
                        /*Obtenemos la descripcion del json*/
                        descCard.appendChild(document.createTextNode(val.descripcion));
                        /*Obtenemos el precio del json*/
                        precioCard.appendChild(document.createTextNode(`$ ${Intl.NumberFormat().format(val.precio)}`));
                        /*Terminamos de generar el texto del boton para comprar*/
                        botonCard.appendChild(document.createTextNode(`Comprar`));
                        /*Aqui agregaremos funcionalidad del boton comprar*/
                        botonCard.addEventListener("click", function () {
                            let carrito = localStorage.getItem("carrito");
                            if (carrito) {
                                let carrito2 = [];
                                carrito2 = JSON.parse(carrito);
                                let agregarCarrito = true;
                                carrito2.forEach(function (task) {
                                    if (task.nombre == val.nombre) {
                                        agregarCarrito = false;
                                    }
                                });
                                if (agregarCarrito) {
                                    carrito2.push(val);
                                }
                                localStorage.setItem("carrito", JSON.stringify(carrito2));
                            } else {
                                let carrito = [];
                                carrito.push(val);
                                localStorage.setItem("carrito", JSON.stringify(carrito));
                            }

                        });

                        /*Agregamos las tallas, el boton de compra, titulo y descripcion 
                        * al layout que es la parte que veremos cuando nos posicionemos 
                        * encima de la card*/

                        cardLayout.appendChild(tituloCard);


                        /*Agregamos a la card la imagen, el precio y la parte de encima de la card*/
                        card.appendChild(imagenCard);
                        card.appendChild(cardLayout);
                        card.appendChild(precioCard);
                        card.appendChild(tallas1);
                        card.appendChild(botonCard);

                        /*Agregar la card al marco*/
                        marcoCard.appendChild(card);
                        /*Agregar el marco a nuestra filas de cards*/
                        row2.appendChild(marcoCard);
                    }
                }
            });
            /*Agregamos nuestra segunda fila a la primera*/
            row1.appendChild(row2);
            /*Agregamos la primer fila a nuestra columna derecha*/
            columnaDerecha.appendChild(row1);


            count++;
        }
    </script>
</body>

</html>